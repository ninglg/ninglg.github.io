{"pageProps":{"post":{"summary":null,"tags":["微服务","分布式系统"],"id":"etcd-intro-and-usage","contentHtml":"<p>Etcd介绍和使用</p>\n<h1>简介</h1>\n<ol>\n<li>Etcd 是 CoreOS 团队于2013年6月发起的开源项目。</li>\n<li>Etcd 的目标是构建一个高可用的分布式键值（key-value）数据库。</li>\n<li>Etcd 内部采用 Raft 协议作为一致性算法，Etcd 会保证所有的节点都会保存数据，并保证数据的一致性和正确性。</li>\n<li>Etcd 基于 Go 语言实现。</li>\n<li>Etcd 既支持 gRPC 交互，也提供了 HTTP API 进行交互。</li>\n<li>Ectd 支持每秒 1w 写操作，数据来源于官方提供的 Benchmark 数据。</li>\n<li>Etcd 支持 SSL/TLS。</li>\n<li>Etcd 比较多的应用场景是用于服务发现，服务发现（Service Discovery）要解决的是分布式系统中最常见的问题之一，即在同一个分布式集群中的进程或服务如何才能找到对方并建立连接。</li>\n<li>Etcd 目前默认使用 2379 端口提供 HTTP API 服务，2380 端口和 peer 通信。</li>\n<li>虽然 Etcd 支持单点部署，但是在生产环境中推荐使用集群方式部署。</li>\n<li>由于 Etcd 内部使用投票机制，一般 Etcd 节点数会选择 3、5、7等奇数，最少节点数量是3个。</li>\n</ol>\n<h1>服务发现</h1>\n<ol>\n<li>从本质上说，服务发现就是要了解集群中是否有进程在监听 UDP 或者 TCP 端口，并且通过名字就可以进行查找和链接。</li>\n<li>用户可以在 Etcd 中注册服务，并且对注册的服务配置 Key TTL，定时保持服务的心跳以达到监控健康状态的效果。</li>\n</ol>\n<h1>安装</h1>\n<pre><code class=\"language-shell\">安装：brew install etcd\n启动服务：brew services start etcd\n检查服务状态：etcdctl endpoint health\n查看版本信息：etcd --version\n</code></pre>\n<blockquote>\n<p>etcd是 server 端，etcdctl 是客户端。</p>\n</blockquote>\n<h1>使用</h1>\n<p>查看版本信息</p>\n<blockquote>\n<p>curl http://127.0.0.1:2379/version\n添加key\netcdctl put mykey \"this is myvalue\"\n查询key\netcdctl get mykey\n删除key\netcdctl del mykey\n监控key的变化事件并得到通知\netcdctl watch mykey</p>\n</blockquote>\n<h1>使用Raft一致性协议</h1>\n<h1>与Zookeeper的区别</h1>\n<ol>\n<li>Zookeeper 起源于 Hadoop 生态系统，etcd 的流行是因为它是 kubernetes 的后台支撑。</li>\n<li>Zookeeper 使用 Zab 协议作为其一致性协议。</li>\n<li>对于 CAP 模型，zookeeper 保障的是 CP。</li>\n<li>Etcd 使用 Raft 算法实现的一致性，比 Zookeeper 的 Zab 算法更简单。</li>\n</ol>\n<h1>其他</h1>\n<ol>\n<li>在正常节点上查看集群状态</li>\n</ol>\n<blockquote>\n<p>etcdctl endpoint status</p>\n</blockquote>\n<ol start=\"2\">\n<li>摘除异常节点</li>\n</ol>\n<blockquote>\n<p>etcdctl member remove $ID</p>\n</blockquote>\n","date":"2015-07-22T10:00:00.000Z","title":"Etcd介绍和使用","published":true,"hideInList":false,"feature":null,"isTop":false},"prevPost":{"summary":null,"tags":["MySQL"],"id":"mysql-binlog-redolog-undolog","title":"MySQL的几种日志","date":"2015-08-11T10:00:00.000Z","published":true,"hideInList":false,"feature":null,"isTop":false},"nextPost":{"summary":null,"tags":["分布式系统"],"id":"evaluation-indicator-of-distributed-system","title":"分布式系统的几个评估指标","date":"2015-07-06T10:00:00.000Z","published":true,"hideInList":false,"feature":null,"isTop":false}},"__N_SSG":true}