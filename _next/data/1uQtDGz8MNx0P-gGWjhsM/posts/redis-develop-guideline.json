{"pageProps":{"post":{"summary":null,"tags":["Redis"],"id":"redis-develop-guideline","contentHtml":"<p>此篇介绍一下Redis相关的开发规范。</p>\n<h2>存储</h2>\n<ol>\n<li>默认都使用redis db 0，一般无需select切换</li>\n<li>禁止在redis中存储图片类型</li>\n</ol>\n<h2>性能</h2>\n<ol>\n<li>10w级别qps的性能系统</li>\n<li>小数据集单个操作，耗时一般小于个位数ms</li>\n<li>使用 SCAN 命令时应该批次使用，单次扫描key数量不应超过2万，间隔0.5s</li>\n<li>时间复杂度为O(n)的命令需要注意N的数量</li>\n</ol>\n<h3>大Key问题避免</h3>\n<ol>\n<li>key的长度建议64个字符以内。</li>\n<li>value的大小要控制在10KB以内。</li>\n<li>hash、list、set、zset的元素个数一般不要超过5000个，元素数量过多可考虑拆分成多个key进行处理。</li>\n</ol>\n<pre><code>在Redis中，一个字符串最大512MB，一个二级数据结构（例如hash、list、set、zset）可以存储大约40亿个(2^32-1)个元素。但实际上中如果符合下面两种情况，一般就认为它是bigkey：\n（1）字符串类型：它的big体现在单个value值很大，一般认为超过10KB就是bigkey。\n（2）非字符串类型：哈希、列表、集合、有序集合，它们的big体现在元素个数太多。\n</code></pre>\n<h3>热点Key问题避免</h3>\n<ol>\n<li>拆分</li>\n</ol>\n<h2>批量处理</h2>\n<ol>\n<li>推荐使用批量操作提升操作效率</li>\n<li>批量命令主要分为两类，原生命令和非原生命令：</li>\n</ol>\n<blockquote>\n<p>原生命令包括：例如mget、mset、hmget、hmset、LPUSH key value集合等\n非原生命令包括：Pipeline</p>\n</blockquote>\n<ol start=\"3\">\n<li>批量数量建议不超过1000，要考虑数据大小，批量太多建议使用hscan、sscan、zscan遍历代替</li>\n</ol>\n<h2>数据过期</h2>\n<ol>\n<li>如果不需要长期存储，需要设定过期时间，固定时间+加一个随机数，防止集中过期</li>\n<li>禁止在集合结构中只存不清，对于集合结构中数据增加频繁必须要有删除机制</li>\n</ol>\n<h2>禁止命令</h2>\n<ol>\n<li>禁止线上使用命令：KEYS、FLUSHDB、FLUSHALL、BGSAVE SAVE BGREWRITEAOF等</li>\n</ol>\n<h2>功能</h2>\n<ol>\n<li>Redis的事务功能较弱，不建议过多使用</li>\n<li>monitor命令要控制使用时间，避免长时间使用</li>\n<li>Redis集群版本在使用Lua上有特殊要求：所有key都应该由 KEYS 数组来传递，所有key必须在1个slot上</li>\n</ol>\n<h2>安全</h2>\n<ol>\n<li>使用密码访问授权，保障安全性</li>\n</ol>\n<h2>线上环境</h2>\n<ol>\n<li>Redis节点内存上限不能超过20G。</li>\n<li>必须设置内存最大值，且必须可用内存不小于10%。</li>\n</ol>\n","date":"2014-10-03T10:00:00.000Z","title":"Redis开发规范","published":true,"hideInList":false,"feature":null,"isTop":false},"prevPost":{"summary":null,"tags":["开发工具"],"id":"common-develop-toolbox","title":"常用开发工具清单","date":"2014-10-15T10:00:00.000Z","published":true,"hideInList":false,"feature":null,"isTop":false},"nextPost":{"summary":null,"tags":["Linux"],"id":"makefile-intro","title":"Makefile介绍","date":"2014-09-17T10:00:00.000Z","published":true,"hideInList":false,"feature":null,"isTop":false}},"__N_SSG":true}