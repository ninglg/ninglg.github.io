{"pageProps":{"post":{"summary":null,"tags":["微服务"],"id":"service-mesh-intro","contentHtml":"<h1>Service Mesh介绍</h1>\n<p>Service Mesh是一个致力于解决服务间通信的基础设施层，其负责在现代云原生应用的复杂服务拓扑下实现请求的可靠传递，在实践中Service Mesh通常实现为一组轻量级网络代理，这些代理与应用程序部署在一起，并且对应用程序透明。</p>\n<p>基础设施层是Service Mesh的定位，致力于解决微服务基础设施标准化、配置化、服务化和产品化问题；服务间通信是Service Mesh技术面对的问题域，对微服务屏蔽通信的复杂度，解决微服务的通信治理问题；请求的可靠传递是Service Mesh的目标；轻量级网络代理是Service Mesh的部署方式；对应用程序透明是Service Mesh的亮点和特色，Service Mesh接入对业务无侵入，可以非常方便地获取Service Mesh带来的便捷性，算是Service Mesh的一大优势。</p>\n<h2>完善的微服务基础设施</h2>\n<p>Service Mesh通过将微服务通信下沉到基础设施层，屏蔽了微服务处理各种通信问题的复杂度，可以看成是微服务之间的抽象协议层，抽象层面可以看成是TCP/IP协议栈的一部分。对于微服务的开发者来说，比如当前使用HTTP或者Thrift进行RPC通信时，你不需要关注TCP/IP这一层的具体实现；有了Service Mesh之后，微服务也不再需要关注RPC通信（包含服务发现、负载均衡、流量调度、限流降级、监控统计等）的一切细节，真正像本地调用一样使用微服务，通信相关的一切工作直接交给Service Mesh。</p>\n<h2>语言无关的通信和链路治理</h2>\n<p>功能上Service Mesh并没有提供任何新的特性和能力，Service Mesh提供的所有通信和服务治理能力在Service Mesh之前的技术中均能找到。Service Mesh改变的是通信和服务治理能力提供的方式，通过将这些能力实现从各语言业务实现中解耦，下沉到基础设施层面，以一种更加通用和标准化的方式提供，屏蔽不同语言、不同平台的差异性，这样不仅有利于通信和服务治理能力的迭代和创新，业务使用的时候也会更加方便。</p>\n<h2>通信和服务治理的标准化</h2>\n<ol>\n<li>微服务治理层面，Service Mesh是标准化、体系化、无侵入的分布式服务治理平台。</li>\n<li>标准化方面，Sidecar成为所有微服务流量通信的约束标准，同时Service Mesh的数据平面和控制平面也通过标准协议进行交互。</li>\n<li>体系化方面，从全局考虑，提供多维度立体的微服务可观测能力（Metric、Trace、Logging），并且提供体系化的服务治理能力，比如限流、熔断、安全、灰度等；最为重要的是，Service Mesh通过透明无侵入的方式提供全面的服务治理能力，对微服务本身不会带来直接影响。</li>\n</ol>\n<h1>具体产品</h1>\n<p>Google联合Lyft等公司推出的Istio，成为Service Mesh领域的明星项目。</p>\n<h1>Service Mesh的基本模式</h1>\n<p>根据Service Mesh的发展历程和使用方式，我们可以把Service Mesh划分为两个模式：</p>\n<h2>Sidecar模式</h2>\n<p>在Service Mesh发展早期，Service Mesh以Sidecar的形态存在。Sidecar模式下，网络代理服务在微服务旁边，为微服务提供通信和链路治理功能。因此，数据平面代理服务也经常被简称为Sidecar。此时，只有数据平面的网络代理服务没有控制平面，和外部基础设施服务的交互直接在网络代理服务中进行。</p>\n<p>Sidecar模式可以看作是第一代Service Mesh，代表有早期的Linkerd和Envoy。</p>\n<p>第一代Service Mesh通过采用Sidecar模式，通过将通信和通信链路治理功能从微服务中剥离出来，实现了通信基础设施的下沉和服务化，这里也体现了架构解耦的思想，通过解耦减少了微服务的负担。</p>\n<h2>第二代Service Mesh模式</h2>\n<p>Sidecar模式的Service Mesh有一个突出的问题，将通信和通信链路治理的所有功能都放到这个代理服务中，导致数据平面代理很重，并且由于承载了太多的特性和功能，使得数据平面代理的更新和修改特别频繁，频繁的更新和升级会导致代理服务出问题的概率增大，影响代理服务的稳定性。同时，Service Mesh模式下，数据平面代理承载了微服务通信的全部流量，对稳定性要求极高，这个服务的任何故障都会对整个系统的稳定性产生很大的影响。为了解决上述频繁升级和稳定性之间的矛盾，将策略和配置决策逻辑从代理服务中脱离出来，形成了独立的控制平面，这就是第二代Service Mesh。</p>\n<p>第二代Service Mesh最重要的标志就是控制平面和数据平面分离。数据平面和控制平面并不是新的概念，路由器/交换机等数据通信产品架构上，就有运行于专门处理器上的控制平面和多个独立运行、用于路由或交换功能的数据平面。SDN（Software Defined Network，软件定义网络）将数据平面和控制平面分离，控制平面具有可编程性，使得网络更加智能、灵活和易扩展，激发了网络技术的又一次革命。</p>\n<p>第二代Service Mesh借鉴了SDN的思路，基于控制平面和数据平面分离思想，有了完善的控制平面：①所有的代理服务都由控制平面掌控，因为控制平面可以控制整个系统，所以提供了强大的控制能力和策略能力；②将具体的控制逻辑从数据平面移除，简化了数据平面的设计，数据平面不需要和外部系统进行交互，数据平面完全聚焦在变更频率很低的流量路由和转发逻辑上，提升了数据平面的稳定性。</p>\n<h1>Service Mesh架构</h1>\n<p>第二代Service Mesh的基本架构上分为数据平面和控制平面两个部分。</p>\n<h2>数据平面</h2>\n<p>数据平面负责代理微服务之间的通信，具体包含RPC通信、服务发现、负载均衡、降级熔断、限流容错等，数据平面可以认为是将Spring Cloud、Dubbo等语言相关的微服务框架中通信和服务治理能力独立出来的一个语言无关的进程，并且更注重通用性和扩展性。在Service Mesh中，不再将数据平面代理视为一个个孤立的组件，而是将这些代理连接在一起形成一个全局的分布式网络。</p>\n<h2>控制平面</h2>\n<p>控制平面负责对数据平面进行管理，定义服务发现、路由、流量控制、遥测统计等策略，这些策略可以是全局的，也可以通过配置某个数据平面节点单独指定。控制平面通过一定的机制将策略下发到各个数据平面节点，数据平面节点在通信时会使用这些策略。</p>\n","date":"2019-04-01","title":"Service Mesh介绍"},"prevPost":{"summary":null,"tags":["开发工具"],"id":"prometheus-intro","title":"Prometheus指标收集聚合平台","date":"2019-05-15"},"nextPost":{"summary":null,"tags":["Golang"],"id":"golang-data-visualization-tool-admin-platform","title":"Go数据可视化工具和数据管理后台","date":"2019-02-15"}},"__N_SSG":true}